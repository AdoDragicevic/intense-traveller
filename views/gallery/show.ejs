<%- include("../partials/header") %>

<!-- style for CSS -->
<style>
	body{
		margin-top: 70px;
	}
</style>


<!-- Jumbotron -->
<header>
	<div class="container">
    	<div class="jumbotron" style=" color: #2c3e50; background-color: #ecf0f1;">
        
			<!-- title -->
			<h1> <i class="fas fa-camera-retro"></i> <%= gallery.title %>  </h1>
        
			<!-- author, date, total likes, edit and delete -->
			<div>
				<p> Published by: <a href="/profile/<%= gallery.author.id %>"> <%= gallery.author.username %> </a> </p>
				<p> <em> Posted on <%= gallery.created.toDateString() %> </em> </p>
				
				
				<!-- show edit and delete buttons only if current user is author or admin -->
				<% if(currentUser && gallery.author.id.equals(currentUser._id) || currentUser && currentUsser.isAdmin){ %>
					
				<!-- Edit button -->
					<a class="btn btn-warning float-right mx-1" href="/gallery/<%= gallery._id %>/edit">Edit</a>

					<!-- Delete button -->
					<form class="d-inline float-right" action="/gallery/<%= gallery._id %>?_method=DELETE" method="POST">
						<input class="btn btn-danger mx-auto" type="submit" value="Delete">
					</form>
				
				<% } %>
				
			</div>
    	</div>
	</div>
</header>


<!-- Display all imgs -->
<main>
	<div class="container">
		<div class="row" id="gallery" data-toggle="modal" data-target="#exampleModal">
			
			<% gallery.imgs.forEach(function(img, i){ %>
				

				<!-- img -->
				<div class="col-sm-6 col-lg-4">
					<img id="<%= i %>" class="img-thumbnail my-2 img-fluid" src="<%= img.img %>" style="width: 100%; height: 200px; object-fit: cover">	
				</div>
				
			
				<!-- save indx of clicked image, in order to acces that img in the modal -->
				
			
				
			
				
			
				<!-- Modal -->
				<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-hidden="true">
					<div class="modal-dialog" role="document">
						<div class="modal-content">

							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true">Ã—</span>
								</button>
							</div>

							<div class="modal-body">
								
								
				
								
								<img src="<%= gallery.imgs[0].img %>">
								
							</div>

							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
							</div>



						</div>
					</div>
				</div>
			
			<% }); %>
		</div>
	</div>
</main>



<% gallery.imgs.forEach(function(img, i){ %>
	<img src="<%= img.img %>">
	<form action="/gallery/<%= gallery._id %>/like/<%= img._id %>" method="POST">
		<button>
			<div class="btn-group">
            	<% if (currentUser && img.likes.some(function (like) {
                	return like.equals(currentUser._id)
            	})) { %>
                	<button class="btn btn-primary">
                    	<i class="fas fa-thumbs-up"></i> Liked (<%= img.likes.length %>)
                	</button>
            	<% } else { %>
                	<button class="btn btn-secondary">
                    	<i class="fas fa-thumbs-up"></i> Like (<%= img.likes.length %>)
                	</button>
            	<% } %>
				<!-- add img._id to the button beneath each img -->
            	<button id="<%= img._id %>" type="button" class="whoLiked btn btn-sm btn-default" data-toggle="modal"
                    data-target="#pictureLikes">See more details
				</button>
        	</div>
		</button>	
	</form>
<% }); %>

<%- include("../partials/footer") %>