<%- include("../partials/header") %>



<h1> <%= gallery.text %> </h1>

<% gallery.imgs.forEach(function(img, i){ %>
	<img src="<%= img.img %>">
	<% %>
	<form action="/gallery/<%= gallery._id %>/like/<%= img._id %>" method="POST">
		<button>
			<div class="btn-group">
            	<% if (currentUser && img.likes.some(function (like) {
                	return like.equals(currentUser._id)
            	})) { %>
                	<button class="btn btn-primary">
                    	<i class="fas fa-thumbs-up"></i> Liked (<%= img.likes.length %>)
                	</button>
            	<% } else { %>
                	<button class="btn btn-secondary">
                    	<i class="fas fa-thumbs-up"></i> Like (<%= img.likes.length %>)
                	</button>
            	<% } %>
				<!-- add img._id to the button beneath each img -->
            	<button id="<%= img._id %>" type="button" class="whoLiked btn btn-sm btn-default" data-toggle="modal"
                    data-target="#pictureLikes">See more details
				</button>
        	</div>
		</button>	
	</form>

<!-- Campground Likes Modal -->
<div id="pictureLikes" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Likes: 
					<% gallery.imgs.forEach(function(img){ %>
						<% if(img._id.equals(picId)){ %>
							<span> <%= img.likes.length %> </span>
						<% } %>
					<% }); %>
				</h4>
            </div>
            <div class="modal-body">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Liked by:</th>
                    </tr>
                    </thead>
                    <tbody>
                    <% gallery.imgs[i].likes.forEach(function(like) { %>
                        <tr>
                            <td><span class="badge"><i class="fas fa-user"></i></span> <%= like.username %></td>
                        </tr>
                    <% }); %>
                    <% if (gallery.imgs[i].likes.length === 0) { %>
                        <tr>
                            <td><em>No likes yet.</em></td>
                        </tr>
                    <% } %>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<% }); %>

<!-- JS enables us to check the separate likes for each picture -->
<script>
	var picId;
	let picBtn = document.querySelectorAll(".whoLiked");
	for(let i = 0; i < picBtn.length; i++){
		picBtn[i].addEventListener("click", function(){
		picId = this.id;
		console.log(picId);
	});
	}
	
</script>


<%- include("../partials/footer") %>



